<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="generator" content="Madoko, version 0.8.2-beta" />
  <meta name="viewport" content="initial-scale=1.0" />
  <meta name="author" content="Huting Lin and Jeff Milling" />
  <title>Web Servers</title>
  <style  class="link">
/* ---------------------------------------------------
   Various settings to display madoko elements correctly.
   For example, lines in tables or a table of contents.

   All rules use specific madoko classes and never just
   a generic element. This means one can safely include
   this CSS into any web page without affecting non-madoko
   content.
----------------------------------------------------*/

/* The table of contents */
.madoko .toc>.tocblock .tocblock .tocblock {
  margin-left: 2.5em;
}

.madoko .toc>.tocblock .tocblock {
  margin-left: 1.7em;
}

.madoko .toc>.tocblock>.tocitem {
  font-weight: bold;
}

.madoko .toc {
  margin-top: 1em;
}

/* Paragraphs */
.madoko p.para-continue {
  margin-bottom: 0pt;
}

.madoko .para-block+p {
  margin-top: 0pt;
}

.madoko ul.para-block, .madoko ol.para-block {
  margin-top: 0pt;
  margin-bottom: 0pt;
}

.madoko ul.para-end, .madoko ol.para-end {
  margin-bottom: 1em;
}

.madoko dl {
  margin-left: 0em;
}

/* Local page links do not get an underline unless hovering */
.madoko a.localref {
  text-decoration: none;
}
.madoko a.localref:hover {
  text-decoration: underline;
}

/* Footnotes */
.madoko .footnotes {
  font-size: smaller;
  margin-top: 2em;
}

.madoko .footnotes hr {
  width: 50%;
  text-align: left;
}

.madoko .footnote { 
  margin-left: 1em;
}
.madoko .footnote-before {
  margin-left: -1em;
  width: 1em;
  display: inline-block;
}

/* Abstract */
.madoko .abstract>p:first-child:before {
  content: "Abstract. ";
  font-weight: bold;
}

.madoko .abstract {
  margin-left: 2.7em;
  margin-right: 2.7em;
  font-size: small;
}


/* Alignment */
.madoko .align-center, .madoko .align-center>p {
  text-align: center !important;
}

.madoko .align-center pre {
  text-align: left;
}

.madoko .align-center>* {
  margin-left: auto !important;
  margin-right: auto !important;
}

.madoko .align-left, .madoko .align-left>p {
  text-align: left !important;
}

.madoko .align-left>* {
  margin-left: 0pt !important;
  margin-right: auto !important;
}

.madoko .align-right, .madoko .align-right>p {
  text-align: right !important;
}

.madoko .align-right>* {
  margin-left: auto !important;
  margin-right: 0pt !important;
}

.madoko .align-center>table,
.madoko .align-left>table,
.madoko .align-right>table {
  text-align: left !important;
}


/* Equations, Figure's etc. */
.madoko .equation-before {
  float: right;
}


/* Bibliography */
.madoko .bibitem {
  font-size: smaller;
}

.madoko .bib-numeric .bibitem {
  margin-left: 3em;
  text-indent: -3em;
}

.madoko .bibitem-before {
  display: none;
}

.madoko .bib-numeric .bibitem-before {
  display: inline-block;
  width: 3em;
  text-align: right;
}

.madoko .bibliography {
}

.madoko .bibsearch {
  font-size: x-small;
  text-decoration:none;
  color: black;
  font-family: "Segoe UI Symbol", Symbola;
}

/* General */
.madoko .block, .madoko .figure, .madoko .bibitem, .madoko .equation {
  margin-top: 1ex;
  margin-bottom: 1ex;
}

.madoko .figure {
  padding: 0.5em;
  margin-left: 0pt;
  margin-right: 0pt;
}

.madoko .hidden {
  display: none;
}

.madoko .invisible {
  visibility: hidden;
}

.madoko.preview .invisible {
  visibility: visible;
  opacity: 0.5;
}
.madoko.preview[data-view=full] .invisible {
  visibility: hidden;
}

.madoko code.code, .madoko span.code {
  white-space: pre-wrap;
}

.madoko hr, hr.madoko {
  border: none;
  border-bottom: black solid 1px;
  margin-bottom: 0.5ex;
}

.madoko .framed>*:first-child {
  margin-top: 0pt;
}
.madoko .framed>*:last-child {
  margin-bottom: 0pt;
}


/* Title, authors */
.madoko .title {
  font-size: xx-large;
  font-weight: bold;
  margin-bottom: 1ex;
}

.madoko .subtitle {
  font-size: x-large;
  margin-bottom: 1ex;
  margin-top: -1ex;
}

.madoko .titleblock>* {
  margin-left: auto;
  margin-right: auto;
  text-align: center;
}

.madoko .titleblock table {
  width: 80%;
}

.madoko .authorblock .author {
  font-size: large;
}

.madoko .titlenote {
  margin-top: -0.5ex;
  margin-bottom: 1.5ex;
}

/* Lists */

.madoko ul.list-star {
  list-style-type: disc;
}

.madoko ul.list-dash {
    list-style-type: none !important;
}

.madoko ul.list-dash > li:before {
    content: "\2013"; 
    position: absolute;
    margin-left: -1em; 
}

.madoko ul.list-plus {
  list-style-type: square;
}

/* Tables */
.madoko table.madoko {
  border-collapse: collapse;
}
.madoko td, .madoko th {
  padding: 0ex 0.5ex;
  margin: 0pt;
  vertical-align: top;
}

.madoko .cell-border-left {
  border-left: 1px solid black;
}
.madoko .cell-border-right {
  border-right: 1px solid black;
}


.madoko thead>tr:first-child>.cell-line,
.madoko tbody:first-child>tr:first-child>.cell-line {
  border-top: 1px solid black;
  border-bottom: none;
}

.madoko .cell-line, .madoko .cell-double-line {
  border-bottom: 1px solid black;
  border-top: none;
}

.madoko .cell-double-line {
  border-top: 1px solid black;
  padding-top: 1.5px !important;
}


/* Math Pre */
.madoko .input-mathpre .MathJax_Display, .madoko .input-mathpre .math-display {
  text-align: left !important;
}

.madoko div.input-mathpre {
  margin-top: 1.5ex;
  margin-bottom: 1ex;
}

.madoko .math-rendering {
  color: gray;
}


/*---------------------------------------------------------------------------
  Default style for syntax highlighting
---------------------------------------------------------------------------*/

.highlighted                        { color: black; }
.highlighted .token.identifier      { }
.highlighted .token.operators       { }
.highlighted .token.keyword         { color: blue }
.highlighted .token.string          { color: maroon } 
.highlighted .token.string.escape   { color: gray }
.highlighted .token.comment         { color: darkgreen }
.highlighted .token.comment.doc     { font-style: normal }
.highlighted .token.constant        { color: purple; }
.highlighted .token.entity          {  }
.highlighted .token.tag             { color: blue }
.highlighted .token.info-token      { color: black }
.highlighted .token.warn-token      { color: black }
.highlighted .token.error-token     { color: darkred }
.highlighted .token.debug-token     { color: gray }
.highlighted .token.regexp          { color: maroon }
.highlighted .token.attribute.name  { color: navy }
.highlighted .token.attribute.value { color: maroon }
.highlighted .token.constructor     { color: purple }
.highlighted .token.namespace       { color: navy }
.highlighted .token.header          { color: navy }
.highlighted .token.type            { color: teal } 
.highlighted .token.type.delimiter  { color: teal; } 
.highlighted .token.predefined      { color: navy }
.highlighted .token.invalid         { border-bottom: red dotted 1px }
.highlighted .token.code            { color: maroon }
.highlighted .token.code.keyword    { color: navy }
.highlighted .token.typevar         { font-style: italic; }

.highlighted .token.delimiter   {  } /* .[curly,square,parenthesis,angle,array,bracket] */
.highlighted .token.number      {  }    /* .[hex,octal,binary,float] */
.highlighted .token.variable    {  }  /* .[name,value]  */
.highlighted .token.meta        { color: navy }      /* .[content] */

.highlighted .token.bold            { font-weight: bold; }
.highlighted .token.italic          { font-style: italic; }


/* Pretty formatting of code */
.madoko pre.pretty, .madoko code.pretty { 
  font-family: Cambria,Times,Georgia,serif;
  font-size: 100%;
}

.madoko .pretty table {
  border-collapse: collapse;
}
.madoko .pretty td {
  padding: 0em;
}
.madoko .pretty td.empty {
  min-width: 1.5ex;
}
.madoko .pretty td.expander {
  width: 100em;
}
.madoko .pretty .token.identifier         { font-style: italic }
.madoko .pretty .token.constructor        { font-style: italic }


/* ---------------------------------------------------
   Styling for full documents
----------------------------------------------------*/
body.madoko, .madoko-body {
  font-family: Cambria,"Times New Roman","Liberation Serif","Times",serif;
  -webkit-text-size-adjust: 100%; /* so math displays well on mobile devices */
}

body.madoko, .madoko-body, body.madoko.preview[data-view=full] {
  padding: 1em 16% 1em 12%;
}

body.madoko.preview {
  padding: 0em 2em 0em 2em;
}

.madoko p,
.madoko li {
  text-align: justify;
}

/* style headings nicer, especially h5 and h6 */
.madoko h1, .madoko h2, .madoko h3, .madoko h4 { 
  margin-top: 1.22em; 
  margin-bottom: 1ex;
}
.madoko h1+p, .madoko h2+p, .madoko h3+p, .madoko h4+p, .madoko h5+p  { 
  margin-top: 1ex;    
}
.madoko h5, .madoko h6 { 
  margin-top: 1ex;
  font-size: 1em;
}
.madoko h5 { 
  margin-bottom: 0.5ex;
}
.madoko h5 + p {
  margin-top: 0.5ex;
}
.madoko h6 { 
  margin-bottom: 0pt;
}
.madoko h6 + p {
  margin-top: 0pt;
}


/* Fix monospace display (see http://code.stephenmorley.org/html-and-css/fixing-browsers-broken-monospace-font-handling/) */
.madoko pre, .madoko code, .madoko kbd, .madoko samp, .madoko tt, .madoko .monospace, .madoko .token.indent, .madoko .reveal pre, .madoko .reveal code, .madoko .email {
  font-family: Consolas,"Andale Mono WT","Andale Mono",Lucida Console,Monaco,monospace,monospace;
  font-size: 0.85em;
}
.madoko pre code, .madoko .token.indent {
  font-size: 0.95em;
}

.madoko pre code {
  font-family: inherit !important;
}

/* Code prettify */
.madoko ol.linenums li {
  background-color: white;
  list-style-type: decimal;
}

/* Merging */
.madoko .remote {
  background-color: #F0FFF0;
}

/* ---------------------------------------------------
   Print settings
----------------------------------------------------*/

@media print {
  body.madoko, .madoko-body {
    font-size: 10pt;
  }
  @page {
    margin: 1in 1.5in;
  }
}

/* ---------------------------------------------------
   Mobile device settings
----------------------------------------------------*/

@media only screen and (max-device-width:1024px) {
  body.madoko, .madoko-body {
    padding-left: 1em;
    padding-right: 1em;
  }
}

  </style>
  <style  class="link">
@media print {
  @page {
     margin: 0.5in;
  }

  h1, h2, h3 { page-break-after: avoid }
  li {page-break-inside: avoid;}

  a.footnote-backref {
    display: none;
  }

  pre {
    background-color: #cccccc;
    border: 1px solid #cccccc;
    padding: 10px;
    font-size: small;
  }

}

pre {
  background-color: #eeeeff;
  border: 1px solid #cccccc;
  padding: 10px;
}

pre code {
  border: none;
  padding: none;
  background-color: transparent;
}

code {
  border: 1px solid #dddddd;
  background-color: #f8f8f8;
  padding: 1px;
}

div .figure {
  width: 40%; 
  margin: auto
}

  </style>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$']]},
       TeX: { 
         Macros: { mathid: ['\\mathit{#1\\hspace{0.1ex}}',1], mathkw: ['\\mathsf{#1}',1],
                   mathspace: ['\\hspace{#1pt}\\hspace{#1pt}\\hspace{#1pt}',1], mathindent: ['\\hspace{#1ex}',1], mathbr: ['\\\\'],
                 },
  
       }
    });
    MathJax.Hub.Register.StartupHook('TeX AMSmath Ready',function () { 
      MathJax.InputJax.TeX.Definitions.environment['mdMathprearray'] = ['AMSarray',null,null,null,'l','0em','0em'];
    });
  </script>
  <script type="text/javascript" class="preview"
    src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

</head>
<body class="madoko">

<h1 id="sec-web-servers"  data-line="8;apache.md:1"  style="bookmark:Web Servers"><span data-line="8;apache.md:1"></span>Web Servers</h1>
<p data-line="8;apache.md:3"><span data-line="8;apache.md:3"></span><em>Originally created by Huting Lin and Jeff Milling</em><span data-line="8;apache.md:3"></span>
</p>
<p class="indent para-continue" data-line="8;apache.md:8"><span data-line="8;apache.md:8"></span>This week, you<span data-line="8;apache.md:8"></span>&#39;<span data-line="8;apache.md:8"></span>ll configure and secure a web server on your VM that is capable
of serving multiple web sites. In all, you<span data-line="8;apache.md:9"></span>&#39;<span data-line="8;apache.md:9"></span>ll serve pages from three sites:
</p>
<ul class="list-dash compact" data-line="8;apache.md:11">
<li data-line="8;apache.md:11"><span data-line="8;apache.md:11"></span><code class="code code1">vm(num).sys.cs.hmc.edu</code><span data-line="8;apache.md:11"></span>: the <span data-line="8;apache.md:11"></span>&#8220;default&#8221;<span data-line="8;apache.md:11"></span> website for your machine
</li>
<li data-line="8;apache.md:12"><span data-line="8;apache.md:12"></span><code class="code code1">www.(your-server).net</code><span data-line="8;apache.md:12"></span>: a virtual host that your machine can serve
</li>
<li data-line="8;apache.md:13"><span data-line="8;apache.md:13"></span><code class="code code1">admin.(your-server).net</code><span data-line="8;apache.md:13"></span>: a password-protected virtual host
</li></ul>

<p data-line="8;apache.md:15"><span data-line="8;apache.md:15"></span>You<span data-line="8;apache.md:15"></span>&#39;<span data-line="8;apache.md:15"></span>ll also configure one of the sites to automatically serve pages via an
encrypted channel, over SSL.
</p><h2 id="sec-background-information"  data-line="8;apache.md:18"  style="bookmark:Background information"><span data-line="8;apache.md:18"></span>Background information</h2>
<p class="para-continue" data-line="8;apache.md:20"><span data-line="8;apache.md:20"></span>Here is some background information that may be useful for this lab:
</p>
<dl class="loose" data-line="8;apache.md:22">
<dt class="dt" style="font-weight:bold">Name resolution</dt>
<dd class="dd" data-line="8;apache.md:22" style="margin-left:1.5em">
<p data-line="8;apache.md:22"><span data-line="8;apache.md:22"></span><a href="http://technet.microsoft.com/en-us/library/cc958812.aspx">A nice article</a><span data-line="8;apache.md:22"></span> and reminder about how name resolution works, plus
instructions for configuring name resolution on UNIX and Windows.
</p></dd>
<dt class="dt" style="font-weight:bold">Apache</dt>
<dd class="dd" data-line="8;apache.md:26" style="margin-left:1.5em">
<p data-line="8;apache.md:26"><span data-line="8;apache.md:26"></span>Apache HTTP server has been the most prevalent web server software on the
internet since 1996. Made by The Apache Software Foundation, Apache HTTP server
is an open source HTTP web server with support for a wide variety of web
frameworks and services. Learning Apache and Apache configuration is an
essential part of any system administrator<span data-line="8;apache.md:30"></span>&#39;<span data-line="8;apache.md:30"></span>s training.
</p></dd>
<dt class="dt" style="font-weight:bold">Apache logs</dt>
<dd class="dd" data-line="8;apache.md:33" style="margin-left:1.5em">
<p data-line="8;apache.md:33"><span data-line="8;apache.md:33"></span>The webserver<span data-line="8;apache.md:33"></span>&#39;<span data-line="8;apache.md:33"></span>s logs can be useful for debugging. They<span data-line="8;apache.md:33"></span>&#39;<span data-line="8;apache.md:33"></span>re located in
</p></dd></dl>
<p class="para-continue" data-line="8;apache.md:35"><span data-line="8;apache.md:35"></span>  <span data-line="8;apache.md:35"></span><code class="code code1">/var/log/apache2</code><span data-line="8;apache.md:35"></span>
</p>
<dl class="compact" data-line="8;apache.md:37">
<dt class="dt" style="font-weight:bold">elinks</dt>
<dd class="dd" data-line="8;apache.md:37" style="margin-left:1.5em"><span data-line="8;apache.md:37"></span>A<span data-line="8;apache.md:37"></span>&nbsp;<a href="http://elinks.or.cz/documentation/html/manual.html-chunked/ch03.html">console-based web browser</a><span data-line="8;apache.md:37"></span> that you can use on your VM to visit web pages.</dd></dl><h2 id="sec-getting-started"  data-line="8;apache.md:40"  style="bookmark:Getting started"><span data-line="8;apache.md:40"></span>Getting started</h2>
<ol class="loose" data-line="8;apache.md:42">
<li data-line="8;apache.md:42">
<p data-line="8;apache.md:42"><span data-line="8;apache.md:42"></span>Write down the URLs for the three websites you<span data-line="8;apache.md:42"></span>&#39;<span data-line="8;apache.md:42"></span>ll create. Fill in the
blanks with the appropriate information (<span data-line="8;apache.md:43"></span>&#8220;your-server&#8221;<span data-line="8;apache.md:43"></span> can be anything you<span data-line="8;apache.md:43"></span>&#39;<span data-line="8;apache.md:43"></span>d
like):
</p>
<ul class="list-dash compact" data-line="8;apache.md:46">
<li data-line="8;apache.md:46"><span data-line="8;apache.md:46"></span><code class="code code1">http://vm(num).sys.cs.hmc.edu/</code><span data-line="8;apache.md:46"></span>
</li>
<li data-line="8;apache.md:47"><span data-line="8;apache.md:47"></span><code class="code code1">http://www.(your-server).net/</code><span data-line="8;apache.md:47"></span>
</li>
<li data-line="8;apache.md:48"><span data-line="8;apache.md:48"></span><code class="code code1">http://admin.(your-server).net/</code><span data-line="8;apache.md:48"></span>
</li></ul>
</li>
<li data-line="8;apache.md:50">
<p data-line="8;apache.md:50"><span data-line="8;apache.md:50"></span>On your VM, open elinks and visit each site. You should be able to confirm
that each site is unreachable (unless you decided to use an existing web 
site<span data-line="8;apache.md:52"></span>&#39;<span data-line="8;apache.md:52"></span>s name for <span data-line="8;apache.md:52"></span>&#8220;your-server&#8221;<span data-line="8;apache.md:52"></span>)
</p></li></ol>
<h2 id="sec-configure-and-start-the-web-server-on-your-vm"  data-line="8;apache.md:54"  style="bookmark:Configure and start the web server on your VM"><span data-line="8;apache.md:54"></span>Configure and start the web server on your VM</h2><h3 id="sec-configure-your-system"  data-line="8;apache.md:56"  style="bookmark:Configure your system"><span data-line="8;apache.md:56"></span>Configure your system</h3>
<ol class="loose" data-line="8;apache.md:58">
<li data-line="8;apache.md:58">
<p data-line="8;apache.md:58"><span data-line="8;apache.md:58"></span>Portage, Gentoo<span data-line="8;apache.md:58"></span>&#39;<span data-line="8;apache.md:58"></span>s package management system, uses USE flags to help
 determine which dependencies to install in order to support your
 packages. View<span data-line="8;apache.md:60"></span><br>
<span data-line="8;apache.md:61"></span> <span data-line="8;apache.md:61"></span><code class="code code1">/etc/portage/make.conf</code><span data-line="8;apache.md:61"></span> to check that support is enabled for the
 apache2 package on your machine. apache2 should be included in the
 USE variable:
</p>
<pre class="para-block pre-indented" data-line="8;apache.md:65"><code> USE=&quot;... apache2 ...&quot;</code></pre>
<p data-line="8;apache.md:67"><span data-line="8;apache.md:67"></span> If it<span data-line="8;apache.md:67"></span>&#39;<span data-line="8;apache.md:67"></span>s not, edit the file to add the apache2 USE flag, then update the
 system by running the following command:
</p>
<pre class="para-block pre-indented" data-line="8;apache.md:70"><code> sudo emerge --ask --changed-use --deep @world</code></pre>
<p data-line="8;apache.md:72"><span data-line="8;apache.md:72"></span><em>Note</em><span data-line="8;apache.md:72"></span>: You can continue on with the rest of the lab (e.g., by logging in to
another session) while the <span data-line="8;apache.md:73"></span><code class="code code1">emerge</code><span data-line="8;apache.md:73"></span> command is running.
</p></li>
<li data-line="8;apache.md:75">
<p data-line="8;apache.md:75"><span data-line="8;apache.md:75"></span>The default configuration for elinks sometimes makes it difficult to view
webpages. You may want to change this configuration. To do so:
</p>
<ol class="compact" data-line="8;apache.md:77">
<li data-line="8;apache.md:77"><span data-line="8;apache.md:77"></span>start up elinks (by running the <span data-line="8;apache.md:77"></span><code class="code code1">elinks</code><span data-line="8;apache.md:77"></span> command)
</li>
<li data-line="8;apache.md:78"><span data-line="8;apache.md:78"></span>click in the menu bar at the top of the window, and select <span data-line="8;apache.md:78"></span><strong>S</strong><span data-line="8;apache.md:78"></span>etup <span data-line="8;apache.md:78"></span><em>(if
clicking doesn&#39;t work, you should be able to press <code class="code code1">ESC</code> to bring up the menu)</em><span data-line="8;apache.md:79"></span>
</li>
<li data-line="8;apache.md:80"><span data-line="8;apache.md:80"></span>select <span data-line="8;apache.md:80"></span><strong>T</strong><span data-line="8;apache.md:80"></span>erminal options
</li>
<li data-line="8;apache.md:81"><span data-line="8;apache.md:81"></span>uncheck the option for Transparency
</li>
<li data-line="8;apache.md:82"><span data-line="8;apache.md:82"></span>click <span data-line="8;apache.md:82"></span><strong>S</strong><span data-line="8;apache.md:82"></span>ave
</li>
<li data-line="8;apache.md:83"><span data-line="8;apache.md:83"></span>click <span data-line="8;apache.md:83"></span><strong>O</strong><span data-line="8;apache.md:83"></span>K
<span data-line="8;apache.md:84"></span> <span data-line="8;apache.md:84"></span> 
</li></ol></li>
<li data-line="8;apache.md:85">
<p data-line="8;apache.md:85"><span data-line="8;apache.md:85"></span>Apache uses two names to connect to the machine on which it<span data-line="8;apache.md:85"></span>&#39;<span data-line="8;apache.md:85"></span>s running:
<span data-line="8;apache.md:86"></span><code class="code code1">localhost</code><span data-line="8;apache.md:86"></span> and your machine<span data-line="8;apache.md:86"></span>&#39;<span data-line="8;apache.md:86"></span>s hostname (which you can compute by running the
command <span data-line="8;apache.md:87"></span><code class="code code1">hostname</code><span data-line="8;apache.md:87"></span>). You need to make sure your /etc/hosts file is correctly, so
that it connects the <span data-line="8;apache.md:88"></span><code class="code code1">localhost</code><span data-line="8;apache.md:88"></span> IP address to the <span data-line="8;apache.md:88"></span><code class="code code1">localhost</code><span data-line="8;apache.md:88"></span> name and to your
machine<span data-line="8;apache.md:89"></span>&#39;<span data-line="8;apache.md:89"></span>s hostname. 
  Open <span data-line="8;apache.md:90"></span><code class="code code1">/etc/hosts</code><span data-line="8;apache.md:90"></span> and edit the line:
</p>
<pre class="para-block pre-indented" data-line="8;apache.md:92"><code> 127.0.0.1       SysAdminVM1 localhost ...
 </code></pre>
<p data-line="8;apache.md:94"><span data-line="8;apache.md:94"></span>  Replace SysAdminVM1 with the output of the <span data-line="8;apache.md:94"></span><code class="code code1">hostname</code><span data-line="8;apache.md:94"></span> command
</p></li></ol>
<h3 id="sec-configure-apache"  data-line="8;apache.md:96"  style="bookmark:Configure apache"><span data-line="8;apache.md:96"></span>Configure apache</h3>
<p class="para-continue" data-line="8;apache.md:97"><span data-line="8;apache.md:97"></span>Apache has two main configuration files in the system:
</p>
<ul class="list-dash loose" data-line="8;apache.md:99">
<li data-line="8;apache.md:99">
<p data-line="8;apache.md:99"><span data-line="8;apache.md:99"></span>Gentoo<span data-line="8;apache.md:99"></span>&#39;<span data-line="8;apache.md:99"></span>s apache2 init script configuration file
  <span data-line="8;apache.md:100"></span><code class="code code1">/etc/conf.d/apache2</code><span data-line="8;apache.md:100"></span>
</p></li>
<li data-line="8;apache.md:102">
<p data-line="8;apache.md:102"><span data-line="8;apache.md:102"></span>Apache server<span data-line="8;apache.md:102"></span>&#39;<span data-line="8;apache.md:102"></span>s conventional configuration file
  <span data-line="8;apache.md:103"></span><code class="code code1">/etc/apache2/httpd.conf</code><span data-line="8;apache.md:103"></span>
</p></li></ul>

<p data-line="8;apache.md:105"><span data-line="8;apache.md:105"></span>Take a look at <span data-line="8;apache.md:105"></span><code class="code code1">/etc/conf.d/apache2</code><span data-line="8;apache.md:105"></span>. The only active line in this file is:
</p>
<pre class="para-block pre-indented" data-line="8;apache.md:107"><code>APACHE2_OPTS=&quot;-D DEFAULT_VHOST -D INFO -D SSL -D SSL_DEFAULT_VHOST -D LANGUAGE&quot; </code></pre>
<p data-line="8;apache.md:109"><span data-line="8;apache.md:109"></span><em>(the one on your system may be a bit different)</em><span data-line="8;apache.md:109"></span>
</p>
<p class="indent para-continue" data-line="8;apache.md:111"><span data-line="8;apache.md:111"></span>The line defines options that will be interpreted by
various configuration files.
</p>
<ol class="compact" data-line="8;apache.md:114">
<li data-line="8;apache.md:114"><span data-line="8;apache.md:114"></span>Modify <span data-line="8;apache.md:114"></span><code class="code code1">/etc/apache2/httpd.conf</code><span data-line="8;apache.md:114"></span> to add a <span data-line="8;apache.md:114"></span><code class="code code1">ServerName</code><span data-line="8;apache.md:114"></span> configuration

<pre class="para-block pre-fenced pre-fenced3" data-line="8;apache.md:115" data-line-code="8;apache.md:116"><code data-line="8;apache.md:116">   ServerName vm(num).sys.cs.hmc.edu</code></pre><span data-line="8;apache.md:118"></span>This line can go anywhere in the file.
</li></ol>

<p data-line="8;apache.md:120"><span data-line="8;apache.md:120"></span>Apache server<span data-line="8;apache.md:120"></span>&#39;<span data-line="8;apache.md:120"></span>s conventional configuration file, <span data-line="8;apache.md:120"></span><code class="code code1">httpd.conf</code><span data-line="8;apache.md:120"></span>, 
is actually only an entry file, or an entry point for
users in a file form, since Apache<span data-line="8;apache.md:122"></span>&#39;<span data-line="8;apache.md:122"></span>s complete configuration is
split in many files in the <span data-line="8;apache.md:123"></span><code class="code code1">/etc/apache2/</code><span data-line="8;apache.md:123"></span> directory, assembled
and connected together by Apache.
</p><h3 id="sec-start-apache"  data-line="8;apache.md:126"  style="bookmark:Start Apache"><span data-line="8;apache.md:126"></span>Start Apache</h3>
<ol class="loose" data-line="8;apache.md:128">
<li data-line="8;apache.md:128">
<p data-line="8;apache.md:128"><span data-line="8;apache.md:128"></span>Run the following command to start up your web server
</p>
<pre class="para-block pre-fenced pre-fenced3" data-line="8;apache.md:130" data-line-code="8;apache.md:131"><code data-line="8;apache.md:131">sudo rc-service apache2 start</code></pre></li></ol>
<h2 id="sec-visit-your-website"  data-line="8;apache.md:134"  style="bookmark:Visit your website"><span data-line="8;apache.md:134"></span>Visit your website</h2>
<p data-line="8;apache.md:135"><span data-line="8;apache.md:135"></span>Try to visit the URL for <span data-line="8;apache.md:135"></span><code class="code code1">vm(num).sys.cs.hmc.edu</code><span data-line="8;apache.md:135"></span>, both on your VM (using elinks)
and in a browser on your own machine. 
</p>
<p class="indent" data-line="8;apache.md:138"><span data-line="8;apache.md:138"></span><em>Note:</em><span data-line="8;apache.md:138"></span> The websites on the VMs are accessible only to visitors with a Claremont
IP address.
</p>
<p class="indent" data-line="8;apache.md:141"><span data-line="8;apache.md:141"></span>If you<span data-line="8;apache.md:141"></span>&#39;<span data-line="8;apache.md:141"></span>re not able to reach the website
from your VM, try editing <span data-line="8;apache.md:142"></span><code class="code code1">/etc/hosts</code><span data-line="8;apache.md:142"></span> so that it looks something like this:
</p>
<pre class="para-block pre-indented" data-line="8;apache.md:144"><code>```
127.0.0.1            localhost
::1                  localhost
(your VM&#39;s IP)       vm(num).sys.cs.hmc.edu
```</code></pre>
<p data-line="8;apache.md:150"><span data-line="8;apache.md:150"></span>If you<span data-line="8;apache.md:150"></span>&#39;<span data-line="8;apache.md:150"></span>re not able to reach the website from your own computer, you can try
<span data-line="8;apache.md:151"></span><a href="http://technet.microsoft.com/en-us/library/cc958812.aspx">configuring the local name database</a><span data-line="8;apache.md:151"></span> in a similar way.
</p><h2 id="sec-creating-name-based-virtual-hosts"  data-line="8;apache.md:153"  style="bookmark:Creating Name-based Virtual Hosts"><span data-line="8;apache.md:153"></span>Creating Name-based Virtual Hosts</h2>
<p data-line="8;apache.md:155"><span data-line="8;apache.md:155"></span>&#8220;Name-based virtual hosts&#8221;<span data-line="8;apache.md:155"></span> is a fancy name for what we implement to
allow our web servers to serve multiple websites. Without virtual hosts,
your webserver would only respond to http://localhost and
http://vm(num).sys.cs.hmc.edu. We create name-based virtual hosts so that our server
responds to other prefixes, like www.(your-server).net, or
admin.(your-server).net. For (your-server), you can name it anything you
want.
</p>
<p class="indent para-continue" data-line="8;apache.md:163"><span data-line="8;apache.md:163"></span>Here<span data-line="8;apache.md:163"></span>&#39;<span data-line="8;apache.md:163"></span>s how to set up a virtual host on your machine:
</p>
<ol class="loose" data-line="8;apache.md:165">
<li data-line="8;apache.md:165">
<p data-line="8;apache.md:165"><span data-line="8;apache.md:165"></span>Go to the directory that stores all the configuration files of
virtual hosts.
</p>
<pre class="para-block pre-indented" data-line="8;apache.md:168"><code>cd /etc/apache2/vhosts.d</code></pre></li>
<li data-line="8;apache.md:170">
<p data-line="8;apache.md:170"><span data-line="8;apache.md:170"></span>Create the file <span data-line="8;apache.md:170"></span><code class="code code1">net.(your-server).www.conf</code><span data-line="8;apache.md:170"></span> and, in the file, type
the following. Try to think about the purpose of each line as you
write them. Each line is explained below.
</p>
<pre class="para-block pre-indented" data-line="8;apache.md:174"><code>&lt;IfDefine DEFAULT_VHOST&gt;
 &lt;VirtualHost *:80&gt;
  ServerName www.(your-server).net
  ServerAlias (your-server).net
  ServerAdmin (name)@(your-server).net
  DocumentRoot &quot;/var/www/net.(your-server).www/htdocs&quot;
  &lt;Directory &quot;/var/www/net.(your-server).www/htdocs&quot;&gt;
   Options Indexes FollowSymLinks
   AllowOverride All
   Order allow,deny
   Allow from all
  &lt;/Directory&gt;
 &lt;/VirtualHost&gt;
&lt;/IfDefine&gt;</code></pre>
<ul class="list-dash loose" data-line="8;apache.md:189">
<li data-line="8;apache.md:189">
<p data-line="8;apache.md:189"><span data-line="8;apache.md:189"></span>The <span data-line="8;apache.md:189"></span><code class="code code1">&lt;IfDefine test&gt;...&lt;/IfDefine&gt;</code><span data-line="8;apache.md:189"></span> section is used to mark
directives that are conditional. The directives within an
<span data-line="8;apache.md:191"></span><code class="code code1">&lt;IfDefine&gt;</code><span data-line="8;apache.md:191"></span> section are only processed if the test is true. If
test is false, everything between the start and end markers is
ignored.
</p></li>
<li data-line="8;apache.md:195">
<p data-line="8;apache.md:195"><span data-line="8;apache.md:195"></span>The <span data-line="8;apache.md:195"></span><code class="code code1">&lt;VirtualHost&gt;...&lt;/VirtualHost&gt;</code><span data-line="8;apache.md:195"></span> section encloses a group of
directives that apply only to a particular virtual host. It also
states which IP address(es) the vhost replies to.
</p>
<ul class="list-dash loose" data-line="8;apache.md:199">
<li data-line="8;apache.md:199">
<p data-line="8;apache.md:199"><span data-line="8;apache.md:199"></span><code class="code code1">ServerName</code><span data-line="8;apache.md:199"></span> is pretty self-explanatory in that it
establishes the name of the server. <span data-line="8;apache.md:200"></span><code class="code code1">ServerAlias</code><span data-line="8;apache.md:200"></span> is also
self-explanatory in that it sets the other possible url<span data-line="8;apache.md:201"></span>&#39;<span data-line="8;apache.md:201"></span>s
that can redirect to this particular virtual host.
</p></li>
<li data-line="8;apache.md:204">
<p data-line="8;apache.md:204"><span data-line="8;apache.md:204"></span><code class="code code1">ServerAdmin</code><span data-line="8;apache.md:204"></span> sets the contact address that the server
includes in any error messages it returns to the client.
</p></li>
<li data-line="8;apache.md:207">
<p data-line="8;apache.md:207"><span data-line="8;apache.md:207"></span><code class="code code1">DocumentRoot</code><span data-line="8;apache.md:207"></span> sets the directory from which httpd will
serve files.
</p></li></ul>
</li>
<li data-line="8;apache.md:210">
<p data-line="8;apache.md:210"><span data-line="8;apache.md:210"></span>The <span data-line="8;apache.md:210"></span><code class="code code1">&lt;Directory&gt;...&lt;/Directory&gt;</code><span data-line="8;apache.md:210"></span> section encloses directives
that will apply to the named directory, sub-directories of that
directory, and the files within the respective directories.
</p>
<ul class="list-dash loose" data-line="8;apache.md:214">
<li data-line="8;apache.md:214">
<p data-line="8;apache.md:214"><span data-line="8;apache.md:214"></span>The <span data-line="8;apache.md:214"></span><code class="code code1">Options</code><span data-line="8;apache.md:214"></span> directive controls which server features,
usually those considered extra features, are available in a
particular directory.
</p></li>
<li data-line="8;apache.md:218">
<p data-line="8;apache.md:218"><span data-line="8;apache.md:218"></span><code class="code code1">AllowOverride</code><span data-line="8;apache.md:218"></span> establishes which directives in <span data-line="8;apache.md:218"></span><code class="code code1">.htaccess</code><span data-line="8;apache.md:218"></span>
files are allowed to override earlier configurations.
</p></li>
<li data-line="8;apache.md:221">
<p data-line="8;apache.md:221"><span data-line="8;apache.md:221"></span>The <span data-line="8;apache.md:221"></span><code class="code code1">Order</code><span data-line="8;apache.md:221"></span> directive controls the default access state of
the site/page, and the order in which the <span data-line="8;apache.md:222"></span><code class="code code1">Allow</code><span data-line="8;apache.md:222"></span> and <span data-line="8;apache.md:222"></span><code class="code code1">Deny</code><span data-line="8;apache.md:222"></span>
directives are evaluated.
</p></li>
<li data-line="8;apache.md:225">
<p data-line="8;apache.md:225"><span data-line="8;apache.md:225"></span><code class="code code1">Allow</code><span data-line="8;apache.md:225"></span> controls which hosts can access an area of the
server, as its name suggests.
</p></li></ul>
</li></ul>

<p data-line="8;apache.md:228"><span data-line="8;apache.md:228"></span><em>For more detailed explanations and examples, visit:</em><span data-line="8;apache.md:228"></span>
</p>
<ul class="list-dash compact" data-line="8;apache.md:229">
<li data-line="8;apache.md:229"><span data-line="8;apache.md:229"></span><a href="http://gentoovps.net/apache-vhost/">http://gentoovps.net/apache-vhost</a><span data-line="8;apache.md:229"></span>
</li>
<li data-line="8;apache.md:230"><span data-line="8;apache.md:230"></span><a href="http://httpd.apache.org/docs/2.2/mod/core.html#ifdefine">http://httpd.apache.org/docs/2.2/mod/core.html#ifdefine</a><span data-line="8;apache.md:230"></span>
</li>
<li data-line="8;apache.md:231"><span data-line="8;apache.md:231"></span><a href="http://httpd.apache.org/docs/2.2/mod/mod_authz_host.html#allow">http://httpd.apache.org/docs/2.2/mod/mod_authz_host.html#allow</a><span data-line="8;apache.md:231"></span>
</li></ul>
</li>
<li data-line="8;apache.md:233">
<p data-line="8;apache.md:233"><span data-line="8;apache.md:233"></span>Make a directory/site root for the new server:
</p>
<pre class="para-block pre-indented" data-line="8;apache.md:235"><code>mkdir -p /var/www/net.(your-server).www/htdocs</code></pre>
<p data-line="8;apache.md:237"><span data-line="8;apache.md:237"></span>NOTE: The <span data-line="8;apache.md:237"></span><code class="code code1">-p</code><span data-line="8;apache.md:237"></span> option tells mkdir to create the parent directories
of the target directory if they don<span data-line="8;apache.md:238"></span>&#39;<span data-line="8;apache.md:238"></span>t exist.
</p>
<p data-line="8;apache.md:240"><span data-line="8;apache.md:240"></span>This directory is where the files for your server<span data-line="8;apache.md:240"></span>&#39;<span data-line="8;apache.md:240"></span>s site will live.
</p></li>
<li data-line="8;apache.md:242">
<p data-line="8;apache.md:242"><span data-line="8;apache.md:242"></span>In that directory, create an easy <span data-line="8;apache.md:242"></span><code class="code code1">index.html</code><span data-line="8;apache.md:242"></span> and add the following to
the file:
</p>
<pre class="para-block pre-indented" data-line="8;apache.md:245"><code>&lt;html&gt;
 &lt;head&gt; 
  &lt;title&gt;www&lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;h1&gt;This is the www page&lt;/h1&gt;
 &lt;/body&gt;
&lt;/html&gt;</code></pre></li>
<li data-line="8;apache.md:254">
<p data-line="8;apache.md:254"><span data-line="8;apache.md:254"></span>To locally associate the IP address with the server name, edit
<span data-line="8;apache.md:255"></span><code class="code code1">/etc/hosts</code><span data-line="8;apache.md:255"></span> and associate www.(your-server).net with the localhost IP
address (127.0.0.1)
</p></li>
<li data-line="8;apache.md:258">
<p data-line="8;apache.md:258"><span data-line="8;apache.md:258"></span>Reload apache<span data-line="8;apache.md:258"></span>&#39;<span data-line="8;apache.md:258"></span>s configuration with the following command:
</p>
<pre class="para-block pre-fenced pre-fenced3" data-line="8;apache.md:259" data-line-code="8;apache.md:260"><code data-line="8;apache.md:260">sudo rc-service apache2 reload</code></pre>
<p data-line="8;apache.md:262"><span data-line="8;apache.md:262"></span><strong>Every time you reconfigure apache, you&#39;ll need to reload the configuration
.</strong><span data-line="8;apache.md:263"></span>
</p></li>
<li data-line="8;apache.md:265">
<p data-line="8;apache.md:265"><span data-line="8;apache.md:265"></span>Check to see if everything<span data-line="8;apache.md:265"></span>&#39;<span data-line="8;apache.md:265"></span>s working by using a browser to
go to <span data-line="8;apache.md:266"></span><code class="code code1">www.(your-server).net</code><span data-line="8;apache.md:266"></span>. <span data-line="8;apache.md:266"></span><strong>You&#39;ll need to use a <em>local</em> browser 
(i.e., a browser on your VM) to visit the site because only your VM can 
resolve the URL.</strong><span data-line="8;apache.md:268"></span>
</p></li></ol>

<p data-line="8;apache.md:270"><span data-line="8;apache.md:270"></span>Let<span data-line="8;apache.md:270"></span>&#39;<span data-line="8;apache.md:270"></span>s also create an administrator site that corresponds to the site you just
created . Call it <span data-line="8;apache.md:271"></span><code class="code code1">admin.(your-server).net</code><span data-line="8;apache.md:271"></span>. <span data-line="8;apache.md:271"></span><strong>Follow the steps above to create
a virtual host for this site.</strong><span data-line="8;apache.md:272"></span> Remember to edit the new admin config file,
specifically the <span data-line="8;apache.md:273"></span><strong>ServerName, DocumentRoot, <em>and</em> Directory</strong><span data-line="8;apache.md:273"></span> directives to
reflect the change from a www page to an admin page. <span data-line="8;apache.md:274"></span><strong>ServerAlias</strong><span data-line="8;apache.md:274"></span> can be
deleted. Also, don<span data-line="8;apache.md:275"></span>&#39;<span data-line="8;apache.md:275"></span>t forget to make the necessary changes to the HTML file as
well. When you<span data-line="8;apache.md:276"></span>&#39;<span data-line="8;apache.md:276"></span>re done, visit the site in a browser to make sure it<span data-line="8;apache.md:276"></span>&#39;<span data-line="8;apache.md:276"></span>s up.
</p><h2 id="sec-activity-with-a-parter"  data-line="8;apache.md:278"  style="bookmark:Activity with a parter"><span data-line="8;apache.md:278"></span>Activity with a parter</h2>
<p class="para-continue" data-line="8;apache.md:279"><span data-line="8;apache.md:279"></span>Grab a partner. From your machine, make sure you can visit:
</p>
<ul class="list-dash compact" data-line="8;apache.md:281">
<li data-line="8;apache.md:281"><span data-line="8;apache.md:281"></span>your partner<span data-line="8;apache.md:281"></span>&#39;<span data-line="8;apache.md:281"></span>s VM website (<span data-line="8;apache.md:281"></span><code class="code code1">http://vm(num).sys.cs.hmc.edu</code><span data-line="8;apache.md:281"></span>)
</li>
<li data-line="8;apache.md:282"><span data-line="8;apache.md:282"></span>your partner<span data-line="8;apache.md:282"></span>&#39;<span data-line="8;apache.md:282"></span>s virtual host (<span data-line="8;apache.md:282"></span><code class="code code1">http://www.(their-server).net</code><span data-line="8;apache.md:282"></span>)
</li>
<li data-line="8;apache.md:283"><span data-line="8;apache.md:283"></span>your partner<span data-line="8;apache.md:283"></span>&#39;<span data-line="8;apache.md:283"></span>s virtual admin host (<span data-line="8;apache.md:283"></span><code class="code code1">http://admin.(their-server).net</code><span data-line="8;apache.md:283"></span>)
</li></ul>

<p data-line="8;apache.md:285"><span data-line="8;apache.md:285"></span>If you<span data-line="8;apache.md:285"></span>&#39;<span data-line="8;apache.md:285"></span>re unable to visit any of these sites, edit <span data-line="8;apache.md:285"></span><code class="code code1">/etc/hosts</code><span data-line="8;apache.md:285"></span> and add a line
like the following:
</p>
<pre class="para-block pre-indented" data-line="8;apache.md:288"><code>partner-ip vm(num).sys.cs.hmc.edu www.(their-server).net admin.(their-server).net</code></pre><h2 id="sec-apache-security-configurations"  data-line="8;apache.md:290"  style="bookmark:Apache Security Configurations"><span data-line="8;apache.md:290"></span>Apache Security Configurations</h2>
<p data-line="8;apache.md:292"><span data-line="8;apache.md:292"></span><em>Note: you&#39;ll need your partner for part of this work</em><span data-line="8;apache.md:292"></span>
</p>
<p class="indent" data-line="8;apache.md:294"><span data-line="8;apache.md:294"></span>As a system administrator it is your job to not only make sure that the
system is fully functioning, but also to make sure the system is secure
and safe. There are a wide variety of nefarious exploits and incorrect
usages that open up when your system is hosting a web service, including
Apache. But if properly configured, it is possible to prevent a majority
of the security vulnerabilities in existence today.
</p><h3 id="sec-step-1--restrict-access-based-on-ip-address"  data-line="8;apache.md:301"  style="bookmark:Step 1: Restrict access based on IP address"><span data-line="8;apache.md:301"></span>Step 1: Restrict access based on IP address</h3>
<p class="para-continue" data-line="8;apache.md:303"><span data-line="8;apache.md:303"></span>We<span data-line="8;apache.md:303"></span>&#39;<span data-line="8;apache.md:303"></span>ll restrict access to <span data-line="8;apache.md:303"></span><code class="code code1">admin.(your-server).net</code><span data-line="8;apache.md:303"></span> so that only certain IP
addresses/machines can access the site. Since our website was just created, it
has some of the weakest security measures available right now. As such, we<span data-line="8;apache.md:305"></span>&#39;<span data-line="8;apache.md:305"></span>ll
just start with something simple and build up from there.
</p>
<ol class="loose" data-line="8;apache.md:308">
<li data-line="8;apache.md:308">
<p data-line="8;apache.md:308"><span data-line="8;apache.md:308"></span>Edit the configuration file for the admin virtual host. In the
<span data-line="8;apache.md:309"></span><code class="code code1">&lt;Directory...&gt;</code><span data-line="8;apache.md:309"></span> section, change the <span data-line="8;apache.md:309"></span><code class="code code1">Allow</code><span data-line="8;apache.md:309"></span> directive from <span data-line="8;apache.md:309"></span><strong>all</strong><span data-line="8;apache.md:309"></span> to the  IP
addresses that you want to allow access. In this case, change it to
<span data-line="8;apache.md:311"></span><strong>127.0.0.1</strong><span data-line="8;apache.md:311"></span>. When you<span data-line="8;apache.md:311"></span>&#39;<span data-line="8;apache.md:311"></span>re done, reload apache. Now apache will only
serve the site<span data-line="8;apache.md:312"></span>&#39;<span data-line="8;apache.md:312"></span>s files to the localhost address.
</p></li>
<li data-line="8;apache.md:314">
<p data-line="8;apache.md:314"><span data-line="8;apache.md:314"></span>Make sure that your partner can no longer access <span data-line="8;apache.md:314"></span><code class="code code1">admin.(your-server).net</code><span data-line="8;apache.md:314"></span>.
</p></li>
<li data-line="8;apache.md:316">
<p data-line="8;apache.md:316"><span data-line="8;apache.md:316"></span>Add your partner<span data-line="8;apache.md:316"></span>&#39;<span data-line="8;apache.md:316"></span>s IP<span data-line="8;apache.md:316"></span>&#39;<span data-line="8;apache.md:316"></span>s to allow them to access your site. Make sure they
can do it. Now apache will only serve the site<span data-line="8;apache.md:317"></span>&#39;<span data-line="8;apache.md:317"></span>s files to the localhost 
address and to your partner<span data-line="8;apache.md:318"></span>&#39;<span data-line="8;apache.md:318"></span>s IP address.
</p></li></ol>

<p data-line="8;apache.md:321"><span data-line="8;apache.md:321"></span>Because of how simple it is to change one<span data-line="8;apache.md:321"></span>&#39;<span data-line="8;apache.md:321"></span>s own IP address, this form of
security is almost useless unless combined with with password protection and
encrypted traffic, to make sure no one else can overhear the exchange of
information (and passwords!).
</p><h3 id="sec-step-2--protect-your-site-with-a-password"  data-line="8;apache.md:326"  style="bookmark:Step 2: Protect your site with a password"><span data-line="8;apache.md:326"></span>Step 2: Protect your site with a password</h3>
<ol class="loose" data-line="8;apache.md:328">
<li data-line="8;apache.md:328">
<p data-line="8;apache.md:328"><span data-line="8;apache.md:328"></span>In <span data-line="8;apache.md:328"></span><code class="code code1">/var/www/net.(your-server).admin/htdocs</code><span data-line="8;apache.md:328"></span>, create a file called
<span data-line="8;apache.md:329"></span><code class="code code1">.htaccess</code><span data-line="8;apache.md:329"></span>. This file is located here instead of the traditional directory
for config files because, as a rule of <span data-line="8;apache.md:330"></span><code class="code code1">.htaccess</code><span data-line="8;apache.md:330"></span> files, they must be located
in the directory they would be affecting. So it will go in the <span data-line="8;apache.md:331"></span><code class="code code1">htdocs</code><span data-line="8;apache.md:331"></span>
directory, where the HTML files will keep it company.
</p></li>
<li data-line="8;apache.md:334">
<p data-line="8;apache.md:334"><span data-line="8;apache.md:334"></span>In <span data-line="8;apache.md:334"></span><code class="code code1">.htaccess</code><span data-line="8;apache.md:334"></span>, type the following (each line is explained
below):
</p>
<pre class="para-block pre-fenced pre-fenced3" data-line="8;apache.md:337" data-line-code="8;apache.md:338"><code data-line="8;apache.md:338">  AuthUserFile /var/www/net.(your-server).admin/conf/admin-auth
  AuthGroupFile /dev/null
  AuthName &quot;Admin only area&quot;
  AuthType Basic

  &lt;Limit GET POST&gt;
   require valid-user
  &lt;/Limit&gt;</code></pre>
<ul class="list-dash loose" data-line="8;apache.md:348">
<li data-line="8;apache.md:348">
<p data-line="8;apache.md:348"><span data-line="8;apache.md:348"></span><code class="code code1">AuthUserFile</code><span data-line="8;apache.md:348"></span> tells the server which text file contains the
  list of users and passwords for authentication.
  <span data-line="8;apache.md:350"></span><code class="code code1">AuthGroupFile</code><span data-line="8;apache.md:350"></span> has a similar function but for groups
  instead.
</p></li>
<li data-line="8;apache.md:353">
<p data-line="8;apache.md:353"><span data-line="8;apache.md:353"></span>The <span data-line="8;apache.md:353"></span><code class="code code1">AuthName</code><span data-line="8;apache.md:353"></span> directive sets the name of the authorization
  realm for a directory, giving the client a hint as to which
  user-password combinations to use.
</p></li>
<li data-line="8;apache.md:357">
<p data-line="8;apache.md:357"><span data-line="8;apache.md:357"></span>Like its name suggests, <span data-line="8;apache.md:357"></span><code class="code code1">AuthType</code><span data-line="8;apache.md:357"></span> sets the type of
  configuration the server would have.
</p></li>
<li data-line="8;apache.md:360">
<p data-line="8;apache.md:360"><span data-line="8;apache.md:360"></span><code class="code code1">&lt;Limit&gt;</code><span data-line="8;apache.md:360"></span> and <span data-line="8;apache.md:360"></span><code class="code code1">&lt;/Limit&gt;</code><span data-line="8;apache.md:360"></span> restrict enclosed access controls
  to only certain HTTP methods. <span data-line="8;apache.md:361"></span><em>Require</em><span data-line="8;apache.md:361"></span> selects which
  authenticated users can access a resource.
</p>
<p data-line="8;apache.md:364"><span data-line="8;apache.md:364"></span><em>For more information and examples, visit:</em><span data-line="8;apache.md:364"></span><br>
<span data-line="8;apache.md:365"></span><a href="http://httpd.apache.org/docs/2.2/mod/mod_authn_file.html">http://httpd.apache.org/docs/2.2/mod/mod_authn_file.html</a><span data-line="8;apache.md:365"></span><br>
<span data-line="8;apache.md:366"></span><em>and</em><span data-line="8;apache.md:366"></span><br>
<span data-line="8;apache.md:367"></span><a href="http://httpd.apache.org/docs/2.2/mod/core.html#require">http://httpd.apache.org/docs/2.2/mod/core.html#require</a><span data-line="8;apache.md:367"></span>
</p></li></ul>
</li>
<li data-line="8;apache.md:369">
<p data-line="8;apache.md:369"><span data-line="8;apache.md:369"></span>Security of files is important too. So, as a precaution, change the
permissions and ownership of .htaccess so you and apache can access the file,
but only the owner can write in it. The backslash indicates that the line
extends to the next line.
</p>
<pre class="para-block pre-indented" data-line="8;apache.md:374"><code>   chgrp apache /var/www/net.(your-server).admin/htdocs/.htaccess

   chmod 640 /var/www/net.(your-server).admin/htdocs/.htaccess</code></pre></li>
<li data-line="8;apache.md:378">
<p data-line="8;apache.md:378"><span data-line="8;apache.md:378"></span>Make the directory <span data-line="8;apache.md:378"></span><code class="code code1">conf</code><span data-line="8;apache.md:378"></span> in the admin page<span data-line="8;apache.md:378"></span>&#39;<span data-line="8;apache.md:378"></span>s directory in <span data-line="8;apache.md:378"></span><code class="code code1">/var/www/net
.(your-server).admin/</code><span data-line="8;apache.md:379"></span>. Once that<span data-line="8;apache.md:379"></span>&#39;<span data-line="8;apache.md:379"></span>s done, we will create the password file
that will contain all the user-password combinations.
</p>
<pre class="para-block pre-fenced pre-fenced3" data-line="8;apache.md:381" data-line-code="8;apache.md:382"><code data-line="8;apache.md:382">   htpasswd -c /var/www/net.(your-server).admin/conf/admin-auth (user)</code></pre>
<p data-line="8;apache.md:385"><span data-line="8;apache.md:385"></span>where <span data-line="8;apache.md:385"></span><code class="code code1">(USER)</code><span data-line="8;apache.md:385"></span> is a name you<span data-line="8;apache.md:385"></span>&#39;<span data-line="8;apache.md:385"></span>d like people to be able to use to log into this
website.
</p>
<p data-line="8;apache.md:388"><span data-line="8;apache.md:388"></span>Later, if you<span data-line="8;apache.md:388"></span>&#39;<span data-line="8;apache.md:388"></span>d like to add more users, you would use the same command but
without the <span data-line="8;apache.md:389"></span><code class="code code1">-c</code><span data-line="8;apache.md:389"></span> option.
</p>
<pre class="para-block pre-fenced pre-fenced3" data-line="8;apache.md:390" data-line-code="8;apache.md:391"><code data-line="8;apache.md:391">   htpasswd /var/www/net.(your-server).admin/conf/admin-auth (user)</code></pre></li>
<li data-line="8;apache.md:394">
<p data-line="8;apache.md:394"><span data-line="8;apache.md:394"></span>Now, protect the password file the same way as you did for
  <span data-line="8;apache.md:395"></span><code class="code code1">.htaccess</code><span data-line="8;apache.md:395"></span>
</p></li>
<li data-line="8;apache.md:397">
<p data-line="8;apache.md:397"><span data-line="8;apache.md:397"></span>Now try it out! You should be greeted with a login page instead this time
around, meaning that the configuration changes worked. P.S. You may have to
reload the page (ctrl-R) in order for the page to reflect the fact that your
user-password combination was correct.
</p></li></ol>
<h3 id="sec-step-3--provide-an-encrypted-connection-to-the-site"  data-line="8;apache.md:402"  style="bookmark:Step 3: Provide an encrypted connection to the site."><span data-line="8;apache.md:402"></span>Step 3: Provide an encrypted connection to the site.</h3>
<p class="para-continue" data-line="8;apache.md:404"><span data-line="8;apache.md:404"></span>Though your page is now somewhat secure, the connection between a machine and
the server is still unguarded. A secure, encrypted ssl connection is called on
by typing <span data-line="8;apache.md:406"></span><code class="code code1">https://</code><span data-line="8;apache.md:406"></span> in the url. However, if you try it now, you would only get
the localhost default page since the admin page is not configured to listen to
port 443. Now, since OpenSSL should already be installed, we can go straight
to generating the encryption key and certificate:
</p>
<ol class="loose" data-line="8;apache.md:411">
<li data-line="8;apache.md:411">
<p data-line="8;apache.md:411"><span data-line="8;apache.md:411"></span>In your home directory, generate an SSL key
</p>
<pre class="para-block pre-indented" data-line="8;apache.md:413"><code>     openssl genrsa 2048 &gt; net.(your-server).key</code></pre></li>
<li data-line="8;apache.md:415">
<p data-line="8;apache.md:415"><span data-line="8;apache.md:415"></span>In your home directory, generate an SSL certificate
</p>
<pre class="para-block pre-fenced pre-fenced3" data-line="8;apache.md:416" data-line-code="8;apache.md:417"><code data-line="8;apache.md:417">   openssl req -new -x509 -nodes -sha1 -key net.(your-server).key &gt; net.(your-server).crt</code></pre>
<p data-line="8;apache.md:420"><span data-line="8;apache.md:420"></span>In the above command, make sure that the option<span data-line="8;apache.md:420"></span> <span data-line="8;apache.md:420"></span>-sha1 contains the number one
and not a lowercase l. When it asks for information, you can fill in however
much you want.
</p></li>
<li data-line="8;apache.md:424">
<p data-line="8;apache.md:424"><span data-line="8;apache.md:424"></span>Move the key and certificate files to <span data-line="8;apache.md:424"></span><code class="code code1">/etc/apache2</code><span data-line="8;apache.md:424"></span>
</p></li>
<li data-line="8;apache.md:426">
<p data-line="8;apache.md:426"><span data-line="8;apache.md:426"></span>Check to make sure <span data-line="8;apache.md:426"></span><code class="code code1">APACHE2_OPTS</code><span data-line="8;apache.md:426"></span> in <span data-line="8;apache.md:426"></span><code class="code code1">/etc/conf.d/apache2</code><span data-line="8;apache.md:426"></span> has
   <span data-line="8;apache.md:427"></span><code class="code code1">SSL</code><span data-line="8;apache.md:427"></span> and <span data-line="8;apache.md:427"></span><code class="code code1">SSL_DEFAULT_VHOST</code><span data-line="8;apache.md:427"></span>.
</p></li>
<li data-line="8;apache.md:429">
<p data-line="8;apache.md:429"><span data-line="8;apache.md:429"></span><code class="code code1">NameVirtualHost</code><span data-line="8;apache.md:429"></span> is a required directive if one wants to configure name-
based virtual hosts. It specifies the IP address on which the server will
receive and answer requests for the virtual hosts, usually used when more than
one vhost listens to the same IP address. So, in
<span data-line="8;apache.md:433"></span><code class="code code1">/etc/apache2/vhosts.d/00_default_ssl_vhost.conf</code><span data-line="8;apache.md:433"></span>, under the <span data-line="8;apache.md:433"></span><strong>Listen</strong><span data-line="8;apache.md:433"></span> line
in the file, add the following:
</p>
<pre class="para-block pre-fenced pre-fenced3" data-line="8;apache.md:435" data-line-code="8;apache.md:436"><code data-line="8;apache.md:436">   NameVirtualHost *:443</code></pre></li>
<li data-line="8;apache.md:439">
<p data-line="8;apache.md:439"><span data-line="8;apache.md:439"></span>Next, we need to configure the admin page to actually have a
  virtual host to answer an SSL connection request. This is
  because the virtual host that is already established only listens to
  requests on port 80, while SSL connections use port 443. Also,
  with its different configurations, the <span data-line="8;apache.md:443"></span>&#8220;non-secure&#8221;<span data-line="8;apache.md:443"></span> vhost and
  the SSL vhost have to remain separate. So, enter the config file
  for the admin page and, directly after the line
  <span data-line="8;apache.md:446"></span><code class="code code1">&lt;/VirtualHost&gt;</code><span data-line="8;apache.md:446"></span>, add the following:
</p>
<pre class="para-block pre-indented" data-line="8;apache.md:448"><code>  &lt;IfDefine SSL&gt;
   &lt;IfModule ssl_module&gt;
    &lt;VirtualHost *:443&gt;
     SSLEngine on
     SSLCertificateFile /etc/apache2/net.(your-server).crt
     SSLCertificateKeyFile /etc/apache2/net.(your-server).key
     
     ServerName admin.(your-server).net
     
     SSLOptions StrictRequire
     SSLProtocol all -SSLv2
     
     SSLCipherSuite RC4-SHA:AES128-SHA:HIGH:!aNULL:!MD5
     SSLHonorCipherOrder on
     
     DocumentRoot &quot;/var/www/net.(your-server).admin/htdocs&quot;
     &lt;Directory &quot;/var/www/net.(your-server).admin/htdocs&quot;&gt;
      SSLRequireSSL
      Options Indexes FollowSymLinks
      AllowOverride All
      Order allow,deny
      Allow from all
     &lt;/Directory&gt;
    &lt;/VirtualHost&gt;
   &lt;/IfModule&gt;
  &lt;/IfDefine&gt;</code></pre>
<ul class="list-dash loose" data-line="8;apache.md:475">
<li data-line="8;apache.md:475">
<p data-line="8;apache.md:475"><span data-line="8;apache.md:475"></span>The <span data-line="8;apache.md:475"></span><code class="code code1">&lt;IfDefine&gt;</code><span data-line="8;apache.md:475"></span> is mentioned before, and the <span data-line="8;apache.md:475"></span><code class="code code1">&lt;IfModule&gt;</code><span data-line="8;apache.md:475"></span>
  section encloses directives that are conditional on the
  presence of a specific module.
</p></li>
<li data-line="8;apache.md:479">
<p data-line="8;apache.md:479"><span data-line="8;apache.md:479"></span><code class="code code1">VirtualHost</code><span data-line="8;apache.md:479"></span> still has the same function, though in this
  case it considers the SSL default port of 443 instead.
</p>
<ul class="list-dash loose" data-line="8;apache.md:482">
<li data-line="8;apache.md:482">
<p data-line="8;apache.md:482"><span data-line="8;apache.md:482"></span>The <span data-line="8;apache.md:482"></span><code class="code code1">SSLEngine</code><span data-line="8;apache.md:482"></span> directive toggles the usage of the
SSL/TLS Protocol Engine, which is responsible for
creating SSL/TLS connections.
</p></li>
<li data-line="8;apache.md:486">
<p data-line="8;apache.md:486"><span data-line="8;apache.md:486"></span>For <span data-line="8;apache.md:486"></span><code class="code code1">SSLCertificateFile</code><span data-line="8;apache.md:486"></span> and <span data-line="8;apache.md:486"></span><code class="code code1">SSLCertificateKeyFile</code><span data-line="8;apache.md:486"></span>,
their names are self-explanatory. They establish the
full path to the SSL key and certificate files created
earlier.
</p></li>
<li data-line="8;apache.md:491">
<p data-line="8;apache.md:491"><span data-line="8;apache.md:491"></span><code class="code code1">SSLOptions</code><span data-line="8;apache.md:491"></span> is used to control various run-time options
on a per-directory basis
</p></li>
<li data-line="8;apache.md:494">
<p data-line="8;apache.md:494"><span data-line="8;apache.md:494"></span>Just like its name, <span data-line="8;apache.md:494"></span><code class="code code1">SSLProtocol</code><span data-line="8;apache.md:494"></span> is used to control
which SSL protocol mod<span data-line="8;apache.md:495"></span>_<span data-line="8;apache.md:495"></span>ssl would use when establishing
the server environment.
</p></li>
<li data-line="8;apache.md:498">
<p data-line="8;apache.md:498"><span data-line="8;apache.md:498"></span><code class="code code1">SSLCipherSuite</code><span data-line="8;apache.md:498"></span> establishes which Cipher Suites are
available for negotiation in a SSL handshake. Meanwhile,
<span data-line="8;apache.md:500"></span><code class="code code1">SSLHonorCipherOrder</code><span data-line="8;apache.md:500"></span>, when enabled, means that
connections will prefer the server<span data-line="8;apache.md:501"></span>&#39;<span data-line="8;apache.md:501"></span>s cipher preference
order when choosing a cipher.
</p></li></ul>
</li>
<li data-line="8;apache.md:504">
<p data-line="8;apache.md:504"><span data-line="8;apache.md:504"></span>In the <span data-line="8;apache.md:504"></span><code class="code code1">&lt;Directory&gt;</code><span data-line="8;apache.md:504"></span> section, whose file condition should
  stay the same, the <span data-line="8;apache.md:505"></span><code class="code code1">SSLRequireSSL</code><span data-line="8;apache.md:505"></span> directory denies the
  client access when SSL is not used for the HTTP request
  a.k.a. HTTPS is not used, though it isn<span data-line="8;apache.md:507"></span>&#39;<span data-line="8;apache.md:507"></span>t as effective as
  the next configuration.
</p>
<p data-line="8;apache.md:510"><span data-line="8;apache.md:510"></span>  <span data-line="8;apache.md:510"></span><strong>Warning</strong><span data-line="8;apache.md:510"></span>: Notice that you allow connections over SSL from <span data-line="8;apache.md:510"></span><em>all</em><span data-line="8;apache.md:510"></span>
  IP addresses. You can change <span data-line="8;apache.md:511"></span><code class="code code1">Allow from all</code><span data-line="8;apache.md:511"></span> to allow from only
  certain IPs, as you did for the non-SSL version.
</p>
<p data-line="8;apache.md:514"><span data-line="8;apache.md:514"></span>NOTE: There should be two lines of <span data-line="8;apache.md:514"></span><code class="code code1">&lt;/IfDefine&gt;</code><span data-line="8;apache.md:514"></span> at the end of
the config file. This is because the new <span data-line="8;apache.md:515"></span><code class="code code1">&lt;IfDefine&gt;</code><span data-line="8;apache.md:515"></span> section is
nested within our <span data-line="8;apache.md:516"></span><code class="code code1">&lt;IfDefine DEFAULT_VHOST&gt;</code><span data-line="8;apache.md:516"></span> section.<span data-line="8;apache.md:516"></span><br>
<span data-line="8;apache.md:517"></span><em>For more information and examples, visit:</em><span data-line="8;apache.md:517"></span><br>
<span data-line="8;apache.md:518"></span><a href="http://httpd.apache.org/docs/2.2/mod/mod_ssl.html">http://httpd.apache.org/docs/2.2/mod/mod_ssl.html</a><span data-line="8;apache.md:518"></span>
</p></li></ul>
</li></ol>

<p data-line="8;apache.md:520"><span data-line="8;apache.md:520"></span>Now you can try this out by using <span data-line="8;apache.md:520"></span><code class="code code1">https://</code><span data-line="8;apache.md:520"></span> in place of <span data-line="8;apache.md:520"></span><code class="code code1">http://</code><span data-line="8;apache.md:520"></span>. Since the
certificate created is extremely sketchy, some browsers might ask if you really
want to continue. Follow the steps to progress, and you should find yourself at
the admin page once again. With the current settings, you will only go through a
ssl-secured network when <span data-line="8;apache.md:524"></span><code class="code code1">https://</code><span data-line="8;apache.md:524"></span> is used. <span data-line="8;apache.md:524"></span><code class="code code1">http://</code><span data-line="8;apache.md:524"></span> will still go through
normal, unsecure connections.
</p>
<p class="indent" data-line="8;apache.md:527"><span data-line="8;apache.md:527"></span>If you encounter the SSL error <span data-line="8;apache.md:527"></span>&#8220;unable to get local
issuer certificate,&#8221;<span data-line="8;apache.md:528"></span> there is a way to fix it! Go to the file
<span data-line="8;apache.md:529"></span><code class="code code1">00_default_ssl_vhost.conf</code><span data-line="8;apache.md:529"></span> and change the
<span data-line="8;apache.md:530"></span><code class="code code1">SSLCertificateKeyFile</code><span data-line="8;apache.md:530"></span> and <span data-line="8;apache.md:530"></span><code class="code code1">SSLCertificateFile</code><span data-line="8;apache.md:530"></span> to the path of
certificate and key you created.
</p>
<p class="indent para-continue" data-line="8;apache.md:533"><span data-line="8;apache.md:533"></span>Now you can set up your site so that <span data-line="8;apache.md:533"></span><strong>all attempts to access the site will go
through SSL.</strong><span data-line="8;apache.md:534"></span>
</p>
<ol class="loose" data-line="8;apache.md:536">
<li data-line="8;apache.md:536">
<p data-line="8;apache.md:536"><span data-line="8;apache.md:536"></span>In the <span data-line="8;apache.md:536"></span><code class="code code1">&lt;VirtualHost *:80&gt;</code><span data-line="8;apache.md:536"></span>
  section of the admin<span data-line="8;apache.md:537"></span>&#39;<span data-line="8;apache.md:537"></span>s conf file, add the following lines:
</p>
<pre class="para-block pre-indented" data-line="8;apache.md:539"><code>  RewriteEngine On
  RewriteCond %{HTTPS} !on
  RewriteRule ^/(.*) https://%{SERVER_NAME}%{REQUEST_URI} [R]</code></pre>
<ul class="list-dash loose" data-line="8;apache.md:543">
<li data-line="8;apache.md:543">
<p data-line="8;apache.md:543"><span data-line="8;apache.md:543"></span>Like SSLEngine, the <span data-line="8;apache.md:543"></span><code class="code code1">RewriteEngine</code><span data-line="8;apache.md:543"></span> directive enables or
  disables the runtime rewriting engine.
</p></li>
<li data-line="8;apache.md:546">
<p data-line="8;apache.md:546"><span data-line="8;apache.md:546"></span><code class="code code1">RewriteCond</code><span data-line="8;apache.md:546"></span> defines the condition under which rewriting
  will take place, while <span data-line="8;apache.md:547"></span><code class="code code1">RewriteRule</code><span data-line="8;apache.md:547"></span> defines the rules for
  the rewriting engine.
</p>
<p data-line="8;apache.md:550"><span data-line="8;apache.md:550"></span><em>For more information and examples, visit:</em><span data-line="8;apache.md:550"></span><br>
<span data-line="8;apache.md:551"></span><a href="http://httpd.apache.org/docs/current/mod/mod_rewrite.html">http://httpd.apache.org/docs/current/mod/mod_rewrite.html</a><span data-line="8;apache.md:551"></span>
</p></li></ul>
</li>
<li data-line="8;apache.md:553">
<p data-line="8;apache.md:553"><span data-line="8;apache.md:553"></span>Now, when you try to access <span data-line="8;apache.md:553"></span><code class="code code1">http://...</code><span data-line="8;apache.md:553"></span>, it should
  automatically connect to <span data-line="8;apache.md:554"></span><code class="code code1">https://...</code><span data-line="8;apache.md:554"></span>. In other words, you will
  always go through a secure connection!
</p></li></ol>

<p data-line="8;apache.md:557"><span data-line="8;apache.md:557"></span>Great! Now you have configured a (relatively) secure website, with an
even more secure admin site. 
</p>
<div class="madokologo block" data-line="11" style="text-align:right;font-size:xx-small;margin-top:4em"><span data-line="12"></span>Created with&nbsp;<a href="https://www.madoko.net">Madoko.net</a>.</div>
</body>

</html>
